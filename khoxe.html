<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω kho xe</title>
</head>
<body>
  <h1>üöó Qu·∫£n l√Ω kho xe</h1>
  <div id="tabs"></div>
  <div id="table-container"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbynYKon7UHmfwL_qRvjVu8c5OuzcoqWGkq0n2ticP7BGPDpI5DC5DH_KgLhqbPXuREO/exec";
    const sheetNames = ["CHU·∫®N B·ªä V·ªÄ", "KHO XE B√ÅN", "H√ÄNG CH·ªú GH√âP XE", "GH√âP XE", "XHƒê", "ƒê√É GIAO XE"];
    let allData = {};
    let activeSheet = "";

    async function fetchData(sheetName) {
      try {
        const res = await fetch(`${API_URL}?action=getSheetData&sheetName=${encodeURIComponent(sheetName)}`);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const json = await res.json();

        if (json.error) {
          console.error(`‚ùå L·ªói d·ªØ li·ªáu t·ª´ sheet ${sheetName}:`, json.message);
          return;
        }

        allData[sheetName] = json;
        if (!activeSheet) {
          activeSheet = sheetName;
          renderTable(sheetName);
        }
      } catch (err) {
        console.error(`L·ªói khi t·∫£i d·ªØ li·ªáu cho ${sheetName}:`, err.message);
      }
    }

    function renderTabs() {
      const tabsDiv = document.getElementById("tabs");
      sheetNames.forEach(name => {
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.onclick = () => {
          activeSheet = name;
          renderTable(name);
        };
        tabsDiv.appendChild(btn);
      });
    }

    function renderTable(sheetName) {
      const container = document.getElementById("table-container");
      container.innerHTML = "";

      const dataObj = allData[sheetName];
      if (!dataObj || !dataObj.headers || !dataObj.data) {
        container.innerHTML = `<p style="color:red;">‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá cho tab: ${sheetName}</p>`;
        return;
      }

      const table = document.createElement("table");
      table.border = "1";

      // Render header
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      Object.values(dataObj.headers).forEach(header => {
        const th = document.createElement("th");
        th.textContent = header;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Render body
      const tbody = document.createElement("tbody");
      dataObj.data.forEach(row => {
        const tr = document.createElement("tr");
        Object.keys(dataObj.headers).forEach(key => {
          const td = document.createElement("td");
          td.textContent = row[key] || "";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      container.appendChild(table);
    }

    async function init() {
      renderTabs();
      for (const name of sheetNames) {
        await fetchData(name); // tu·∫ßn t·ª± t·ª´ng sheet
      }
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
